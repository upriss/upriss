<HTML>
<TITLE>Part 10</Title>
<body>
<h3>1 Networking</h3>

<li>Protocols
<li>Bottom layers: physical network, IP, TCP 
<li>Top layers: FTP, telnet, http
<li>Type of connection: connection-oriented vs. packet-oriented

<h4>1.1 The http protocol</h4>

You can manually interact with a webserver by typing <font color=blue>
telnet www.soc.napier.ac.uk 80</font>, then type <font color=blue>
GET / HTTP/1.0</font> and then press enter twice. In general,
the format of the first line of an HTTP request is <p>
METHOD space Request-URI space HTTP-Version \n\n<p>
Methods are GET, HEAD, OPTIONS, POST, DELETE, etc. The Request-URI
is usually the path and name of the document (eg. "/" or "/somedir/index.html").
The HTTP-Version is currently either 1.0 or 1.1.
<p>
The HTTP request is normally generated by the user's browser. A typical
request with "GET" is 
<p>
<pre>
GET /cgi-bin/somefile.cgi HTTP/1.0
CONNECTION: Keep-Alive
USER-AGENT: Mozilla/4.0 (compatible; MSIE 5.22; Mac_PowerPC)
PRAGMA: no-cache
HOST: www.dcs.napier.ac.uk
ACCEPT: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, */*
QUERY_STRING: name=Mary&comments=Hello
</pre>
<p>
A typical request with  "POST" is  
<pre>
POST /cgi-bin/somefile.cgi HTTP/1.0
REFERER: http://www.dcs.napier.ac.uk/cgi-bin/someform.html
CONNECTION: Keep-Alive
USER-AGENT: Mozilla/4.0 (compatible; MSIE 5.22; Mac_PowerPC)
HOST: www.dcs.napier.ac.uk
ACCEPT: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, */*
CONTENT-TYPE: application/x-www-form-urlencoded
CONTENT-LENGTH: 42

name=Mary&comments=Hello
</pre>
<p>
A typical answer from a webserver starts like this:
<p>
<pre>
HTTP/1.1 200 OK
Date: Thu, 18 Nov 2004 15:41:04 GMT
Server: Apache/2.0.40 (Red Hat Linux)
Accept-Ranges: bytes
X-Powered-By: Open SoCks 1.2.0000
Last modified: Thu, 18 Nov 2004 15:41:04 GMT
Connection: close
Content-Type: text/html; charset=ISO-8859-1

&#60;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" 
"http://www.w3.org/TR/html4/loose.dtd"&#62;

&#60;html&#62;
</pre>
<p>
These are different possible first lines (302 indicates a redirection):
<p>
<pre>
HTTP/1.1 200 OK
HTTP/1.1 404 Not Found
HTTP/1.1 302 Found
HTTP/1.0 500 internal error
</pre>

<h4>1.2 Exercises</h4>

1) Find out which options are accepted by www.soc.napier.ac.uk (Hint:
use * as the Request-URI.)

<h4>1.3 Connecting to the http port with Perl</h4>

There are different ways to download pages from the web with Perl.
The IO::Socket module provides a primitive interface which shows
most of the HTTP interaction fairly openly. The LWP module provides
a more sophisticated user-friendly interface (and implements the
libwww-perl library). It would be possible to use LWP to implement a 
basic command-line browser. Documentation about LWP can be found 
<a href="http://search.cpan.org/~gaas/libwww-perl-5.801/lwpcook.pod">here</a>
and 
<a href="http://search.cpan.org/~gaas/libwww-perl-5.801/lib/LWP.pm">here</a>.

<h4>1.4 An example using IO::Socket</h4>

In this script "$remote" is a variable for a two directional socket
handle (similar to a filehandle, which is usually one directional).
<p>
<font color=blue>
#!/usr/local/bin/perl<br>
use IO::Socket;<br>
<br>
$current_host = "www.napier.ac.uk";<br>
$current_doc = "/";<br>
<br>
$remote =IO::Socket::INET->new(Proto => "tcp",<br>
PeerAddr => $current_host,<br>
PeerPort => "http(80)",<br>
);<br>
if (!$remote) {die "cannot connect to http daemon on $current_host"}<br>
$remote->autoflush(1);<br>
print $remote "GET $current_doc HTTP/1.0\r\n";<br>
 print $remote "Host: $current_host\r\n\r\n";<br>
$line = &#60$remote&#62 ; <br>
while ($line) {<br>
print "$line";<br>
$line = &#60$remote&#62 ; <br>
}<br>
close $remote;<br>
</font>

<h4>1.5 Exercises</h4>

2) Try the script using pages you know. Notice the text that is 
printed before the "&#60;html&#62;" tag (use "more" so that it doesn't
scroll of the screen). What happens if there exists no
file at the requested URL?
<p>
3) Print the output to a file and then view the file through your browser.


<h4>1.6 Examples using LWP</h4>

The simplest version for retrieving a document is 
<p>
<font color=blue>
use LWP::Simple;<br>
$doc = get 'http://www.napier.ac.uk/';<br>
print $doc;<br>
</font>
<p>
The user-agent version of LWP allows to control the HTTP request
header information, to use cookies, https and password protected pages.
<p>
<font color=blue>
use LWP::UserAgent;<br>
$ua = LWP::UserAgent->new;<br>
$req = HTTP::Request->new(GET => 'http://www.napier.ac.uk/');<br>
$req->header('Accept' => 'text/html');<br>
$res = $ua->request($req);<br>
if ($res->is_success) {<br>
print $res->content;<br>
} else {<br>
print "Error: " . $res->status_line . "\n";<br>
}<br>
</font>

<h4>1.7 Exercises</h4>

4) Modify the LWP user agent
example above so that it sends a request to one of your
webpages, which contains a form. Hints: use "POST" instead of "GET".
The $req->content_type('...') should be set according to the information
under 1.1 above. The $req->content('...') should contain the query string.

<h3>2 Connecting to other CGI sites</h3>

To connect to another CGI script on the web you can submit the 
information that the script requires via the URL and then 
display the result through your CGI script.
For example, type<br>
http://search.yahoo.com/bin/search?p=WORD<br>
into the URL field  of your browser and replace WORD by a topic you want
to retrieve. 

<h4>2.1 Exercises</h4>

5) Incorporate this into the 
script from exercise 4). Let the user input a topic. 
Display the result without any Javascript, images, advertisments  etc,
which might be on the page.
<p>
Note: it may be illegal to incorporate other CGI scripts
into your script without asking the owner of the original script
for permission. At a minimum you would have to inform users about
the underlying script. 

<h3>3 Optional: Connecting to the ftp port</h3>

In the example below, you need to fill in the addess of an anonymous ftp
server and your email address before you use the script.
This script is only an example of how to use the IO::Socket. For 
serious implementations, LWP or NET::FTP should be used. 
<P>
<font color=blue>
#!/usr/local/bin/perl -w<br>
use IO::Socket;<br>
<br>
$current_host ="ftp.somewhere.ac.uk";<br>
$email_address ="user\@napier.ac.uk";<br>
<br>
$remote =IO::Socket::INET->new(Proto => "tcp",<br>
PeerAddr => $current_host,<br>
PeerPort => "ftp(21)",<br>
);<br>
if (!$remote) { die "cannot connect to http daemon on $current_host"}<br>
$remote->autoflush(1);<br>
print $remote "USER anonymous\n";<br>
print $remote "PASS $email_address\n";<br>
print $remote "quit\n";<br>
while (&#60$remote&#62)<br>
{print;}<br>
close $remote;<br>
</font>

<h3>4 HTML Parsing and Web Crawlers</h3>

See the example of "searching a webpage" in week 7, number 3.

</body>
</html>
