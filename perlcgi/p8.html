<HTML>
<TITLE>Week 8</Title>

<body>

<h3>1 Session management and maintaining state</h3>

Session management or state maintenance poses a challenge for any 
server-side web 
language. This is because, in contrast to stand-alone applications,
server-side applications transfer data between servers and clients.
A server-side application does not have full control over the data
at the client's computer. A client can delete, modify or add to any
data. Therefore client-data cannot be trusted. 
<p>
Sessions are created to minimise the risk of data corruption. All user
data is stored on the server and associated with a session ID. 
Data retrieval is based on the session ID. A security check must be 
performed on any data, which a user enters, before the data is stored
on the server. It is not necessary to perform security checks on
data that is retrieved from the server. This is in contrast to PHP
applications without sessions: in that case a security check must
be performed on user data every time the data is used! 
<p>
The session IDs should be generated by the server and should be long 
and complicated enough to deter users from manual tampering with the IDs. 
Session IDs are passed from page to page either 
<li>by using hidden HTML form text or 
<li>by using the query string or
<li>by using cookies (on the client computer).
<p>
The user data, which is associated with a session ID can be stored on 
the server
<li>in a file
<li>in a database.
<p>
This approach reduces the number of security checks that must be performed
on user data. Because users can modify their cookies (or disallow cookies)
and can modify hidden HTML form text or query strings, it is possible
for a hacker to break into another user's session.
This problem affects all server-side web languages, not just Perl and PHP.
For highly sensitive applications, other measures, such as encryption (SSL)
and password protection must be added. 

<h4>1.1 Hidden Text - Exercise</h4>

1) Create a form that asks a user for his/her name and some comments.
Then create two PHP scripts that create a response. The first script
displays the information which the user has submitted ("Hello $name.
These are your comments: $comments") and asks the user whether he/she
really wants to submit the information. The second script is invoked
by the first one and displays "Thank you $name. Your comments 
have been submitted: $comments".
<p>
To implement this add a form and hidden tags to the first PHP script,
such as
<p><font color=blue>
&#60;input type='hidden' name='hiddenname' value=\"$name\"&#62;<br>
&#60;input type='hidden' name='hiddencomments' value=\"$comments\"&#62;
</font><p>
The second PHP script retrieves these strings via
<p><font color=blue>
$name = $_REQUEST['hiddenname'];<br>
$comments = $_REQUEST['hiddencomments'];
</font><p>

<h4>1.2 Cookies - Exercise</h4>

2) Use a cookie instead of hidden text in the previous exercise.
<p>
The following code in the first PHP script sets a cookie.

<p><font color=blue>
$cookiedata = $name."|".$comments;<br>
setcookie("nameandcomments", $cookiedata, time()+3600);<br>
</font><p>

Note: the cookie must be set at the very beginning of the PHP script before 
any other HTML code or header information is generated. Even blank space
at the beginning of the file can create a problem!!!
<p>
The second PHP script retrieves the cookie similarly to retrieving
parameters:

<p><font color=blue>
$array = preg_split('/\|/',$_COOKIE['nameandcomments']);<br>
$name = $array[0];<br>
$comments = $array[1];<br>
<p></font>

More information about <a href="http://www.php.net/manual/en/features.cookies.php">
PHP cookies</a>.

<h4>1.3 Using Sessions</h4>

3) Use <a href="http://www.php.net/manual/en/ref.session.php">PHP session
handling functions</a> for the previous exercise. (In particular,
have a look at the <a href="http://www.php.net/manual/en/function.session-start.php">
examples for session_start</a> or
<a href="http://www.php.net/manual/en/session.idpassing.php">this example</a>.)

<h4>1.4 Hit Counter - Exercise</h4>

4) Create a file that contains
only the number "0". Your PHP script must open that file for reading;
read the first line of the file into a scalar variable; increase the 
number by one; close the file; open the file again for writing (not
appending); write the number to the file; close the file.
<p>
(On Unix: because of permissions, first, you need to create and save the file
manually. Then you need to change the file permissions to 666 on the
command-line.)

<h3>2 Optional: Password protected pages</h3>

Access to web sites on an Apache Server can be controlled using the
HTACCESS files. Two files are involved in access control: a
.www-password file is created and saved in a directory above the
public_html directory. Any directory under the public_html
directory can then be protected by saving a .htaccess file in
the directory. It should be noted that htaccess only encrypts
the password but not the pages. Therefore it does not provide high
level security. Furthermore, htaccess does not protect your files
from being viewed by other Unix users on the same computer.

<h4>2.1 Optional exercise</h4>

Create a password protected directory under your public_html
directory. Specific instructions:

<li>Go to your top level directory and type
<font color=blue>htpasswd ~/.www-password remoteuser</font>
at the Unix prompt. You can replace <font color=blue>remoteuser</font> with 
a login name you want to use for your pages. Type in a
password when prompted. Note that this should be a new password,
different from any password you are using for other purposes.
The .www-password file must be readable by others.
<li>Create a new directory under public_html. Go to the directory.
Create a file called .htaccess with the following content:<br>
<font color=blue>
AuthType Basic<br>
AuthName "Password Required"<br>
AuthUserFile /home/yourmatricnumber/.www-password<br>
AuthGroupFile /dev/null<br>
&#60;Limit GET POST&#62;<br>
require user remoteuser<br>
&#60;/Limit&#62; <br>
</font>
where <font color=blue>yourmatricnumber</font> is your matric number
and <font color=blue>remoteuser</font> is the same name you used above.

<li>Change the .htaccess file to readable (chmod 644 .htaccess)
<li>If you view any html from that directory through your browser,
you should now be prompted for a username and password.



</body>
</html>
